<!doctype html public "-//W3C//DTD HTML 4.0 Frameset//EN""http://www.w3.org/TR/REC-html40/frameset.dtd">
<html>
<head>
<title>
<a href='http://mapbuilder.sourceforge.net'>Community Map Builder</a> 22 Dec 2006 Overview
</title>
<link rel ="stylesheet" type="text/css" href="stylesheet.css" title="Style">
<script>
function asd() {
	
		parent.document.title="EditSLD.js Overview";
	
}
</script>
</head>
<body bgcolor="white" onload="asd();">

<!-- ========== START OF NAVBAR ========== -->
<a name="navbar_top"><!-- --></a>
<table border="0" width="100%" cellpadding="1" cellspacing="0">
<tr>
<td colspan=2 bgcolor="#EEEEFF" class="NavBarCell1">
<a name="navbar_top_firstrow"><!-- --></a>
<table border="0" cellpadding="0" cellspacing="3">
  <tr align="center" valign="top">
  
  
  <td bgcolor="#EEEEFF" class="NavBarCell1">    <a href="overview-summary.html"><font class="NavBarFont1"><b>Overview</b></font></a>&nbsp;</td>
  <td bgcolor="#FFFFFF" class="NavBarCell1Rev">	&nbsp;<font class="NavBarFont1Rev"><b>File</b></font>&nbsp;</td>
  

  <td bgcolor="#FFFFFF" class="NavBarCell1"> 	<font class="NavBarFont1">Class</font>&nbsp;</td>
  <td bgcolor="#EEEEFF" class="NavBarCell1">    <a href="overview-tree.html"><font class="NavBarFont1"><b>Tree</b></font></a>&nbsp;</td>
  <td bgcolor="#EEEEFF" class="NavBarCell1">    <a href="index-all.html"--><font class="NavBarFont1"><b>Index</b></font></a>&nbsp;</td>
  <td bgcolor="#EEEEFF" class="NavBarCell1">    <a href="help-doc.html"><font class="NavBarFont1"><b>Help</b></font></a>&nbsp;</td>
  </tr>
</table>
</td>
<td bgcolor="#EEEEFF" align="right" valign="top">
<em>
<b><a href='http://mapbuilder.sourceforge.net'>Community Map Builder</a> 22 Dec 2006</b></em>
</td>
</tr>

<tr>
<td bgcolor="white" class="NavBarCell2"><font size="-2">
&nbsp;PREV&nbsp;
&nbsp;NEXT</font></td>
<td bgcolor="white" class="NavBarCell2"><font size="-2">
  <a href="index.html" target="_top"><b>FRAMES</b></a>  &nbsp;
&nbsp;<a href="overview-summary.html" target="_top"><b>NO FRAMES</b></a>
&nbsp;&nbsp;
<script>
  <!--
  if(window==top) {
    document.writeln('<A HREF="allclasses-noframe.html" TARGET=""><B>All Classes</B></A>');
  }
  //-->
</script>
<noscript>
<a href="allclasses-noframe.html" target=""><b>All Classes</b></a>
</noscript>
</font></td>
</tr>
</table>
<!-- =========== END OF NAVBAR =========== -->

<hr>
<center>
	
	   <h2>EditSLD.js</h2>
	
</center>

	


<h4>Summary</h4>
<p>
	
		No overview generated for 'EditSLD.js'<BR/><BR/>
	
</p>

<hr>



<!-- ========== METHOD SUMMARY =========== -->

	<a name="method_summary"><!-- --></a>
	<table border="1" cellpadding="3" cellspacing="0" width="100%">
		<tr bgcolor="#CCCCFF" class="TableHeadingColor">
			<td colspan=2>
				<font size="+2">
					<b>Method Summary</b>
				</font>
			</td>
		</tr>
	
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;void</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#EditSLD">EditSLD</a></b>(toolNode, model)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 
		      </td>
		   </tr>
		
	
	</table>
    <p>

<!-- ========== END METHOD SUMMARY =========== -->


        <pre class="sourceview"><span class="comment">/*
Author:     
License:      LGPL as per: http://www.gnu.org/copyleft/lesser.html

$Id:  1
*/</span>
<span class="comment">
// Ensure this object's dependancies are loaded.</span>
mapbuilder.loadScript(baseDir+<span class="literal">"/tool/ToolBase.js"</span>);

<span class="reserved">function</span> EditSLD(toolNode, model) {

  	ToolBase.apply(<span class="reserved">this</span>, new Array(toolNode, model));
<span class="comment">//  	this.targetModel.doc.namespace="xmlns:context='http://www.opengis.net/context' xmlns:xlink='http://www.w3.org/1999/xlink' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance'"</span>
<span class="comment">//	this.targetModel.namespace = "xmlns:mb='http://mapbuilder.sourceforge.net/mapbuilder' xmlns:wmc='http://www.opengis.net/context' xmlns:xsl='http://www.w3.org/1999/XSL/Transform'";</span>
	
	var styleUrl = baseDir+<span class="literal">"/tool/xsl/wmc_AddSld.xsl"</span>;   //TBD figure out a way to set <span class="reserved">this</span> <span class="reserved">for</span> other operations
    <span class="reserved">this</span>.stylesheet = new XslProcessor(styleUrl);
	
  	<span class="reserved">this</span>.checkThis= <span class="reserved">function</span>(){
<span class="comment">  	//alert("checkthis");alert(Sarissa.serialize(this.model.doc));</span>
  		<span class="reserved">if</span> (document.getElementById(<span class="literal">"textStyle"</span>).checked == true)
    	{	
<span class="comment">    		//this.addNodeToSLD("PolygonSymbolizer");</span>
	 			
        	 <span class="reserved">this</span>.addNodeToSLD(<span class="literal">"TextSymbolizer"</span>);
        	 document.getElementById(<span class="literal">"textStyle"</span>).checked=true;
        	 manageDiv(<span class="literal">'propertyText'</span>,1);
        	 alert(<span class="literal">"checked"</span>);
        	 alert(Sarissa.serialize(<span class="reserved">this</span>.model.doc));
    	}
  		<span class="reserved">else</span> 
  		{
  			<span class="reserved">if</span>(<span class="reserved">this</span>.model.doc.selectSingleNode(<span class="literal">"//TextSymbolizer"</span>)!=null)
	 		{	xpath=<span class="literal">"//FeatureTypeStyle"</span>;
		 		node = <span class="reserved">this</span>.model.doc.selectSingleNode(xpath);
	 			node.removeChild(<span class="reserved">this</span>.model.doc.selectSingleNode(<span class="literal">"//TextSymbolizer"</span>).parentNode);
	 			<span class="reserved">this</span>.addNodeToSLD(document.getElementById(<span class="literal">"choixFeatureType"</span>).value+<span class="literal">"Symbolizer"</span>);
	 			manageDiv(<span class="literal">'propertyText'</span>,0);
	 			alert(Sarissa.serialize(<span class="reserved">this</span>.model.doc));
	 		}
  		}
  	}
  	
  <span class="comment">/**
   * Adds a new LayerName to  the sld document
   * <span class="attrib">@param</span> 
   */</span> 
	<span class="reserved">this</span>.updateNode = <span class="reserved">function</span>(xpath,value){

		<span class="reserved">if</span> (xpath==<span class="literal">'//MinScaleDenominator2'</span>)
		{
			node = <span class="reserved">this</span>.model.doc.selectNodes(<span class="literal">"//MinScaleDenominator"</span>);	
			node[1].firstChild.nodeValue=value;
		}
		<span class="reserved">else</span> <span class="reserved">if</span>(xpath==<span class="literal">'//MaxScaleDenominator2'</span>)
		{
			node2 = <span class="reserved">this</span>.model.doc.selectNodes(<span class="literal">"//MaxScaleDenominator"</span>);
			node2[1].firstChild.nodeValue=value;
		
		}
		<span class="reserved">else</span> <span class="reserved">if</span>((<span class="reserved">this</span>.model.doc.selectSingleNode(xpath)!=null)&amp;&amp;(value))
		{	

			<span class="reserved">this</span>.model.setXpathValue(<span class="reserved">this</span>.model,xpath,value,false);
		}

		
		
	 }
	 <span class="comment">/**
   * Adds a new node Symnolizer to  the sld document
   * version 2
   */</span>  
	  
	 <span class="reserved">this</span>.insertSldToWmc= <span class="reserved">function</span>(layerName)
	 { 
		<span class="reserved">if</span>(layerName)
	 	{  
			var feature = <span class="reserved">this</span>.model.getSldNode();
			
		    var newNode = <span class="reserved">this</span>.stylesheet.transformNodeToObject(feature);

		    Sarissa.setXpathNamespaces(newNode, <span class="reserved">this</span>.targetModel.namespace);

			
		    <span class="reserved">if</span> (<span class="reserved">this</span>.debug) alert(newNode.xml);
		     legendURLNode=<span class="reserved">this</span>.targetModel.doc.selectSingleNode(<span class="literal">"//wmc:Layer[wmc:Name='"</span>+layerName+<span class="literal">"']/wmc:StyleList/wmc:Style/wmc:LegendURL"</span>);
		  
		    layerNode=<span class="reserved">this</span>.targetModel.doc.selectSingleNode(<span class="literal">"//wmc:Layer[wmc:Name='"</span>+layerName+<span class="literal">"']"</span>);
			styleNode=<span class="reserved">this</span>.targetModel.doc.selectSingleNode(<span class="literal">"//wmc:Layer[wmc:Name='"</span>+layerName+<span class="literal">"']/wmc:StyleList"</span>);
		    
		   
		    <span class="reserved">if</span>(styleNode)
			{
		    	layerNode.removeChild(styleNode);
			}
		    <span class="reserved">this</span>.targetModel.setParam(<span class="literal">'addSLD'</span>,newNode.documentElement);
		    
		    <span class="reserved">if</span>(legendURLNode)
		    { 
		    	styleNode=<span class="reserved">this</span>.targetModel.doc.selectSingleNode(<span class="literal">"//wmc:Layer[wmc:Name='"</span>+layerName+<span class="literal">"']/wmc:StyleList/wmc:Style"</span>)	
		    	styleNode.appendChild(legendURLNode);
		    	
		    }
		     config.objects.mainMap.setParam(<span class="literal">"refresh"</span>);
<span class="comment">		    //alert("fin"); </span>
    	}
	 	<span class="reserved">else</span> alert(<span class="literal">"Select a layer if you want insert sld in wmc"</span>);
	 	
	}
    
    
    
    
    

    
    
    
	<span class="comment">/**
   * Adds a new node Symnolizer to  the sld document
   * version 1
   */</span>  
	 <span class="reserved">this</span>.insertSldaToWmc= <span class="reserved">function</span>(layerName){
	 
	 <span class="reserved">if</span>(layerName)
	 {
		sl=<span class="reserved">this</span>.targetModel.doc.createElement(<span class="literal">"StyleList"</span>);
		
		st=<span class="reserved">this</span>.targetModel.doc.createElement(<span class="literal">"Style"</span>);
		st.setAttribute(<span class="literal">"current"</span>,<span class="literal">"1"</span>);
		
		sld=<span class="reserved">this</span>.targetModel.doc.createElement(<span class="literal">"SLD"</span>);

		node = <span class="reserved">this</span>.model.doc.selectSingleNode(<span class="literal">"//StyledLayerDescriptor"</span>).cloneNode(<span class="literal">'true'</span>);
	
		sld.appendChild(node);

		st.appendChild(sld);
		sl.appendChild(st);
	
		layerNode=<span class="reserved">this</span>.targetModel.doc.selectSingleNode(<span class="literal">"//wmc:Layer[wmc:Name='"</span>+layerName+<span class="literal">"']"</span>);
		styleNode=<span class="reserved">this</span>.targetModel.doc.selectSingleNode(<span class="literal">"//wmc:Layer[wmc:Name='"</span>+layerName+<span class="literal">"']/wmc:StyleList"</span>);

				<span class="reserved">if</span>(styleNode)
				{
					layerNode.removeChild(styleNode);
					layerNode.appendChild(sl);
					config.objects.mainMap.setParam(<span class="literal">"refresh"</span>);

				}
				<span class="reserved">else</span>
				{ 	
					layerNode.appendChild(sl);
					config.objects.mainMap.setParam(<span class="literal">"refresh"</span>);
				}
				alert(<span class="literal">"Apres : "</span>+Sarissa.serialize(<span class="reserved">this</span>.targetModel.doc));
				
	 }
	 <span class="reserved">else</span> alert(<span class="literal">"Select a layer if you want insert sld in wmc"</span>);
	}
	 
	 
	 
	 
	 
<span class="comment">/**
   * Valid the sld document
   * 
   */</span> 	 

<span class="reserved">this</span>.validSld=<span class="reserved">function</span>(layerName)
	{	//alert(document.getElementById(<span class="literal">"selectPropertyCanvas"</span>));
		
	      <span class="reserved">if</span>(!layerName)
	      {
	      	alert(<span class="literal">"pas de layer selectionnee"</span>);
		  }
	      <span class="reserved">else</span> <span class="reserved">if</span>(((document.getElementById(<span class="literal">"textStyle"</span>).checked == true) &amp;&amp; (document.getElementById(<span class="literal">"selectPropertyCanvas"</span>)))||(document.getElementById(<span class="literal">"textStyle"</span>).checked == false))
	      {			
	      			<span class="reserved">this</span>.updateNodeCss(document.getElementById(<span class="literal">"fill"</span>).id,<span class="literal">'//PolygonSymbolizer/Fill/CssParameter[@name='</span>,document.getElementById(<span class="literal">'fill'</span>).value);
					<span class="reserved">this</span>.updateNodeCss(document.getElementById(<span class="literal">'fill'</span>).id,<span class="literal">'//PointSymbolizer/Graphic/Mark/Fill/CssParameter[@name='</span>,document.getElementById(<span class="literal">'fill'</span>).value);
					<span class="reserved">this</span>.updateNodeCss(document.getElementById(<span class="literal">'stroke'</span>).id,<span class="literal">'//CssParameter[@name='</span>,document.getElementById(<span class="literal">'stroke'</span>).value);
					<span class="reserved">this</span>.updateNodeCss(<span class="literal">'fill'</span>,<span class="literal">'//TextSymbolizer/Fill/CssParameter[@name='</span>,document.getElementById(<span class="literal">'fontColor'</span>).value);
	      			<span class="reserved">this</span>.insertSldToWmc(layerName);
	      			
	      			config.loadModel(<span class="literal">'mySLD'</span>,<span class="reserved">this</span>.model.url);
	      			
		  }
	      <span class="reserved">else</span> <span class="reserved">if</span> (!document.getElementById(<span class="literal">"selectPropertyCanvas"</span>))
	      {
	      alert(<span class="literal">"pas de propriete selectionnee"</span>);
	     
	      }
<span class="comment">	    //config.objects.mainMap.setModel('mainMap',config.objects.mainMap.doc);</span>
	}
	
	
} 
</pre>
	<hr>



<!-- ========== START OF NAVBAR ========== -->
<a name="navbar_top"><!-- --></a>
<table border="0" width="100%" cellpadding="1" cellspacing="0">
<tr>
<td colspan=2 bgcolor="#EEEEFF" class="NavBarCell1">
<a name="navbar_top_firstrow"><!-- --></a>
<table border="0" cellpadding="0" cellspacing="3">
  <tr align="center" valign="top">
  
  
  <td bgcolor="#EEEEFF" class="NavBarCell1">    <a href="overview-summary.html"><font class="NavBarFont1"><b>Overview</b></font></a>&nbsp;</td>
  <td bgcolor="#FFFFFF" class="NavBarCell1Rev">	&nbsp;<font class="NavBarFont1Rev"><b>File</b></font>&nbsp;</td>
  

  <td bgcolor="#FFFFFF" class="NavBarCell1"> <font class="NavBarFont1">Class</font>&nbsp;</td>
  <td bgcolor="#EEEEFF" class="NavBarCell1">    <a href="overview-tree.html"><font class="NavBarFont1"><b>Tree</b></font></a>&nbsp;</td>
  <td bgcolor="#EEEEFF" class="NavBarCell1">    <a href="index-all.html"--><font class="NavBarFont1"><b>Index</b></font></a>&nbsp;</td>
  <td bgcolor="#EEEEFF" class="NavBarCell1">    <a href="help-doc.html"><font class="NavBarFont1"><b>Help</b></font></a>&nbsp;</td>
  </tr>
</table>
</td>
<td bgcolor="#EEEEFF" align="right" valign="top"><em>
<b><a href='http://mapbuilder.sourceforge.net'>Community Map Builder</a> 22 Dec 2006</b></em>
</td>
</tr>

<tr>
<td bgcolor="white" class="NavBarCell2"><font size="-2">
&nbsp;PREV&nbsp;
&nbsp;NEXT</font></td>
<td bgcolor="white" class="NavBarCell2"><font size="-2">
  <a href="index.html" target="_top"><b>FRAMES</b></a>  &nbsp;
&nbsp;<a href="overview-summary.html" target="_top"><b>NO FRAMES</b></a>
&nbsp;&nbsp;
<script>
  <!--
  if(window==top) {
    document.writeln('<A HREF="allclasses-noframe.html" TARGET=""><B>All Classes</B></A>');
  }
  //-->
</script>
<noscript>
<a href="allclasses-noframe.html" target=""><b>All Classes</b></a>
</noscript>
</font></td>
</tr>
</table>
<!-- =========== END OF NAVBAR =========== -->

<hr>
<font size="-1">

</font>
<div class="jsdoc_ctime">Documentation generated by <a href="http://jsdoc.sourceforge.net/" target="_parent">JSDoc</a> on Fri Dec 22 07:58:58 2006</div>
</body>
</html>
