<!doctype html public "-//W3C//DTD HTML 4.0 Frameset//EN""http://www.w3.org/TR/REC-html40/frameset.dtd">
<html>
<head>
<title>
<a href='http://mapbuilder.sourceforge.net'>Community Map Builder</a> 22 Dec 2006 Overview
</title>
<link rel ="stylesheet" type="text/css" href="stylesheet.css" title="Style">
<script>
function asd() {
	
		parent.document.title="Proj.js Overview";
	
}
</script>
</head>
<body bgcolor="white" onload="asd();">

<!-- ========== START OF NAVBAR ========== -->
<a name="navbar_top"><!-- --></a>
<table border="0" width="100%" cellpadding="1" cellspacing="0">
<tr>
<td colspan=2 bgcolor="#EEEEFF" class="NavBarCell1">
<a name="navbar_top_firstrow"><!-- --></a>
<table border="0" cellpadding="0" cellspacing="3">
  <tr align="center" valign="top">
  
  
  <td bgcolor="#EEEEFF" class="NavBarCell1">    <a href="overview-summary.html"><font class="NavBarFont1"><b>Overview</b></font></a>&nbsp;</td>
  <td bgcolor="#FFFFFF" class="NavBarCell1Rev">	&nbsp;<font class="NavBarFont1Rev"><b>File</b></font>&nbsp;</td>
  

  <td bgcolor="#FFFFFF" class="NavBarCell1"> 	<font class="NavBarFont1">Class</font>&nbsp;</td>
  <td bgcolor="#EEEEFF" class="NavBarCell1">    <a href="overview-tree.html"><font class="NavBarFont1"><b>Tree</b></font></a>&nbsp;</td>
  <td bgcolor="#EEEEFF" class="NavBarCell1">    <a href="index-all.html"--><font class="NavBarFont1"><b>Index</b></font></a>&nbsp;</td>
  <td bgcolor="#EEEEFF" class="NavBarCell1">    <a href="help-doc.html"><font class="NavBarFont1"><b>Help</b></font></a>&nbsp;</td>
  </tr>
</table>
</td>
<td bgcolor="#EEEEFF" align="right" valign="top">
<em>
<b><a href='http://mapbuilder.sourceforge.net'>Community Map Builder</a> 22 Dec 2006</b></em>
</td>
</tr>

<tr>
<td bgcolor="white" class="NavBarCell2"><font size="-2">
&nbsp;PREV&nbsp;
&nbsp;NEXT</font></td>
<td bgcolor="white" class="NavBarCell2"><font size="-2">
  <a href="index.html" target="_top"><b>FRAMES</b></a>  &nbsp;
&nbsp;<a href="overview-summary.html" target="_top"><b>NO FRAMES</b></a>
&nbsp;&nbsp;
<script>
  <!--
  if(window==top) {
    document.writeln('<A HREF="allclasses-noframe.html" TARGET=""><B>All Classes</B></A>');
  }
  //-->
</script>
<noscript>
<a href="allclasses-noframe.html" target=""><b>All Classes</b></a>
</noscript>
</font></td>
</tr>
</table>
<!-- =========== END OF NAVBAR =========== -->

<hr>
<center>
	
	   <h2>Proj.js</h2>
	
</center>

	


<h4>Summary</h4>
<p>
	
		No overview generated for 'Proj.js'<BR/><BR/>
	
</p>

<hr>


    <table border="1" cellpadding="3" cellspacing="0" width="100%">
    <tr bgcolor="#CCCCFF" class="TableHeadingColor">
    <td colspan=2><font size="+2">
    
        <b>Class Summary</b>
    
    </font></td>
    </tr>
    
    <tr bgcolor="white" class="TableRowColor">
    <td width="15%"><b><a href="Proj.html">Proj</a></b></td>
    <td>&nbsp;</td>
    </tr>
    
    </table>
    <hr/> 


<!-- ========== METHOD SUMMARY =========== -->

	<a name="method_summary"><!-- --></a>
	<table border="1" cellpadding="3" cellspacing="0" width="100%">
		<tr bgcolor="#CCCCFF" class="TableHeadingColor">
			<td colspan=2>
				<font size="+2">
					<b>Method Summary</b>
				</font>
			</td>
		</tr>
	
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;void</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#adjust_lon">adjust_lon</a></b>(x)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#bilinterp">bilinterp</a></b>(x, y, a, b, c, d)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 Bilinear interpolation function to return an interpolated value for either
 x or y for some point located within a box where the XY of the corners are known.
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;void</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#e0fn">e0fn</a></b>(x)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;void</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#e1fn">e1fn</a></b>(x)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;void</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#e2fn">e2fn</a></b>(x)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;void</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#e3fn">e3fn</a></b>(x)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#gmap_forward">gmap_forward</a></b>(coords)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#gmap_inverse">gmap_inverse</a></b>(coords)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#lcc2ll">lcc2ll</a></b>(coords)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#ll2lcc">ll2lcc</a></b>(coords)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#ll2m">ll2m</a></b>(coords)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#ll2pixel">ll2pixel</a></b>(coords)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#ll2ps">ll2ps</a></b>(coords)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#ll2scene">ll2scene</a></b>(coords)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 Scene projection forward transformation.
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#ll2st">ll2st</a></b>(coords)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#ll2tm">ll2tm</a></b>(coords)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 Transverse Mercator Forward  - long/lat to x/y
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#m2ll">m2ll</a></b>(coords)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;void</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#minit">minit</a></b>(param)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 NAME                            MERCATOR


		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;void</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#mlfn">mlfn</a></b>(e0,e1,e2,e3,phi)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#msfnz">msfnz</a></b>(eccent, sinphi, cosphi)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#phi2z">phi2z</a></b>(eccent, ts)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#pixel2ll">pixel2ll</a></b>(coords)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#ps2ll">ps2ll</a></b>(coords)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;void</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#psinit">psinit</a></b>(param)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#scene2ll">scene2ll</a></b>(coords)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 Scene projection Inverse transformation.
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;void</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#sceneInit">sceneInit</a></b>(param)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 Scene projection initialization function
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#semi_minor">semi_minor</a></b>(a, f)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;void</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#sign">sign</a></b>(x)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#st2ll">st2ll</a></b>(coords)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;void</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#stint">stint</a></b>(param)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#tm2ll">tm2ll</a></b>(coords)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 Transverse Mercator Inverse  -  x/y to long/lat
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;void</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#tminit">tminit</a></b>(param)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 Initialize Transverse Mercator projection
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#tsfnz">tsfnz</a></b>(eccent, phi, sinphi)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;void</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#utminit">utminit</a></b>(param)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 Initialize UTM projection
		      </td>
		   </tr>
		
	
	</table>
    <p>

<!-- ========== END METHOD SUMMARY =========== -->


        <pre class="sourceview"><span class="comment">/*
Author:       Mike Adair mike.adairATccrs.nrcan.gc.ca
              Richard Greenwood rich<span class="attrib">@greenwoodmap</span>.com
License:      LGPL as per: http://www.gnu.org/copyleft/lesser.html
              Note: This program uses algorithms derived from GCTPC at
              http://edcftp.cr.usgs.gov/pub//software/gctpc/ .  As this
              code belongs to the US Government, we believe it is available
              to the public domain and hence is compabible with the LGPL.
$Id: Proj.js 2362 2006-11-30 09:38:43Z oterral $
*/</span>

<span class="comment">/**
 * Provides latitude/longitude to map projection (and vice versa) transformation methods.
 * Initialized with EPSG codes.  Has properties for units and title strings.
 * All coordinates are handled as points which is a 2 element array where x is
 * the first element and y is the second.
 * For the Forward() method pass in lat/lon and it returns map XY.
 * For the Inverse() method pass in map XY and it returns lat/long.
 *
 * TBD: retrieve initialization params (and conversion code?) from a web service
 *
 * <span class="attrib">@constructor</span>
 *
 * <span class="attrib">@param</span> srs         The SRS (EPSG code) of the projection
 */</span>

<span class="reserved">function</span> Proj(srs) {
  <span class="reserved">this</span>.srs = srs.toUpperCase();
  switch(<span class="reserved">this</span>.srs) {
    case <span class="literal">"EPSG:GMAPS"</span>:
      <span class="reserved">this</span>.Forward = identity; //gmap_forward;
      <span class="reserved">this</span>.Inverse = identity; //gmap_inverse;
      <span class="reserved">this</span>.units = <span class="literal">"degrees"</span>;
      <span class="reserved">this</span>.title = <span class="literal">"Google Maps"</span>;
      break;
<span class="comment">
//      this.Forward = gmap_forward;</span>
<span class="comment">//      this.Inverse = gmap_inverse;</span>
<span class="comment">//      this.units = "degrees";</span>
<span class="comment">//      this.title = "Google Maps";</span>
<span class="comment">//      break;</span>

    case <span class="literal">"EPSG:4326"</span>:       //lat/lon projection WGS_84
    case <span class="literal">"EPSG:4269"</span>:       //lat/lon projection WGS_84
    case <span class="literal">"CRS:84"</span>:          //lat/lon projection WGS_84
    case <span class="literal">"EPSG:4965"</span>:       //lat/lon projection RGF93G IGN-F FD 2005
    case new String(<span class="literal">"http://www.opengis.net/gml/srs/epsg.xml#4326"</span>).toUpperCase():
      <span class="reserved">this</span>.Forward = identity;
      <span class="reserved">this</span>.Inverse = identity;
      <span class="reserved">this</span>.units = <span class="literal">"degrees"</span>;
      <span class="reserved">this</span>.title = <span class="literal">"Lat/Long"</span>;
      break;
    case <span class="literal">"EPSG:42101"</span>:        //North American LCC WGS_84
      <span class="reserved">this</span>.Init = lccinit;
      <span class="reserved">this</span>.Forward = ll2lcc;
      <span class="reserved">this</span>.Inverse = lcc2ll;
      <span class="reserved">this</span>.Init(new Array(6378137.0,6356752.314245,49.0,77.0,-95.0, 0.0, 0.0, -8000000));
      <span class="reserved">this</span>.units = <span class="literal">"meters"</span>;
      <span class="reserved">this</span>.title = <span class="literal">"Lambert Conformal Conic"</span>;
      break;
    case <span class="literal">"EPSG:42304"</span>:        //North American LCC NAD_83
      <span class="reserved">this</span>.Init = lccinit;
      <span class="reserved">this</span>.Forward = ll2lcc;
      <span class="reserved">this</span>.Inverse = lcc2ll;
      <span class="reserved">this</span>.Init(new Array(6378137.0,6356752.314,49.0,77.0,-95.0, 49.0, 0.0, 0));
      <span class="reserved">this</span>.units = <span class="literal">"meters"</span>;
      <span class="reserved">this</span>.title = <span class="literal">"Lambert Conformal Conic"</span>;
      break;
    case <span class="literal">"EPSG:26986"</span>:        //NAD83 / Massachusetts Mainland
      <span class="reserved">this</span>.Init = lccinit;
      <span class="reserved">this</span>.Forward = ll2lcc;
      <span class="reserved">this</span>.Inverse = lcc2ll;
      <span class="reserved">this</span>.Init(new Array(6378137.0,6356752.314,42.68333333333333,41.71666666666667,-71.5, 41.0, 200000, 750000));
      <span class="reserved">this</span>.units = <span class="literal">"meters"</span>;
      <span class="reserved">this</span>.title = <span class="literal">"Massachusetts Mainland (LCC)"</span>;
      break;
    case <span class="literal">"EPSG:32761"</span>:        //Polar Stereographic
    case <span class="literal">"EPSG:32661"</span>:
      <span class="reserved">this</span>.Init = psinit;
      <span class="reserved">this</span>.Forward = ll2ps;
      <span class="reserved">this</span>.Inverse = ps2ll;
      <span class="reserved">this</span>.Init(new Array(6378137.0, 6356752.314245, 0.0, -90.0, 2000000, 2000000));
      <span class="reserved">this</span>.units = <span class="literal">"meters"</span>;
      <span class="reserved">this</span>.title = <span class="literal">"Polar Stereographic"</span>;
      break;
    case <span class="literal">"EPSG:27561"</span>://LAMB1 IGN-F modification FD 2005
      <span class="reserved">this</span>.Init = lccinit;
      <span class="reserved">this</span>.Forward = ll2lcc;
      <span class="reserved">this</span>.Inverse = lcc2ll;
      <span class="reserved">this</span>.Init(new Array(6378249.2, 6356515.0, 49.50, 49.50, 2.33722916655, 49.50, 600000.0, 200000.0));
      <span class="reserved">this</span>.units = <span class="literal">"meters"</span>;
      <span class="reserved">this</span>.title = <span class="literal">"Lambert Conformal Conic"</span>;
      break;
    case <span class="literal">"EPSG:27562"</span>://LAMB2 IGN-F modification FD 2005
      <span class="reserved">this</span>.Init = lccinit;
      <span class="reserved">this</span>.Forward = ll2lcc;
      <span class="reserved">this</span>.Inverse = lcc2ll;
      <span class="reserved">this</span>.Init(new Array(6378249.2, 6356515.0, 46.80, 46.80, 2.33722916655, 46.8, 600000.0, 200000.0));
      <span class="reserved">this</span>.units = <span class="literal">"meters"</span>;
      <span class="reserved">this</span>.title = <span class="literal">"Lambert Conformal Conic"</span>;
      break;
    case <span class="literal">"EPSG:27572"</span>://LAMBE IGN-F modification FD 2005
    case <span class="literal">"EPSG:27582"</span>://LAMB2 IGN-F modification (deprecated) FD 2005
      <span class="reserved">this</span>.Init = lccinit;
      <span class="reserved">this</span>.Forward = ll2lcc;
      <span class="reserved">this</span>.Inverse = lcc2ll;
      <span class="reserved">this</span>.Init(new Array(6378249.2, 6356515.0, 46.80, 46.80, 2.33722916655, 46.8, 600000.0, 2200000.0));
      <span class="reserved">this</span>.units = <span class="literal">"meters"</span>;
      <span class="reserved">this</span>.title = <span class="literal">"Lambert Conformal Conic"</span>;
      break;
    case <span class="literal">"EPSG:27563"</span>://LAMB3 IGN-F modification FD 2005
      <span class="reserved">this</span>.Init = lccinit;
      <span class="reserved">this</span>.Forward = ll2lcc;
      <span class="reserved">this</span>.Inverse = lcc2ll;
      <span class="reserved">this</span>.Init(new Array(6378249.2, 6356515.0, 44.10, 44.10, 2.33722916655, 44.10, 600000.0, 200000.0));
      <span class="reserved">this</span>.units = <span class="literal">"meters"</span>;
      <span class="reserved">this</span>.title = <span class="literal">"Lambert Conformal Conic"</span>;
      break;
      case <span class="literal">"EPSG:9804"</span>://Mercator_1SP 
      <span class="reserved">this</span>.Init = minit;
      <span class="reserved">this</span>.Forward = ll2m;
      <span class="reserved">this</span>.Inverse = m2ll;
      <span class="reserved">this</span>.Init(new Array(wgs84[0],wgs84[1],0.0,0.0,0.0,0.0));
      <span class="reserved">this</span>.units = <span class="literal">"meters"</span>;
      <span class="reserved">this</span>.title = <span class="literal">"Mercator"</span>;
      break;
    case <span class="literal">"EPSG:27564"</span>://LAMB4 IGN-F modification FD 2005
      <span class="reserved">this</span>.Init = lccinit;
      <span class="reserved">this</span>.Forward = ll2lcc;
      <span class="reserved">this</span>.Inverse = lcc2ll;
      <span class="reserved">this</span>.Init(new Array(6378249.2, 6356515.0, 42.17, 42.17, 2.33722916655, 42.17, 234.358, 185861.369));
      <span class="reserved">this</span>.units = <span class="literal">"meters"</span>;
      <span class="reserved">this</span>.title = <span class="literal">"Lambert Conformal Conic"</span>;
      break;
    case <span class="literal">"EPSG:2154"</span> ://LAMB93 IGN-F modification FD 2005
      <span class="reserved">this</span>.Init = lccinit;
      <span class="reserved">this</span>.Forward = ll2lcc;
      <span class="reserved">this</span>.Inverse = lcc2ll;
      <span class="reserved">this</span>.Init(new Array(6378137.0, 6356752.3141, 44.00, 49.00, 3.00000000001, 46.50, 700000.0, 6600000.0));
      <span class="reserved">this</span>.units = <span class="literal">"meters"</span>;
      <span class="reserved">this</span>.title = <span class="literal">"Lambert Conformal Conic"</span>;
      break;
    case <span class="literal">"EPSG:4326"</span>:case <span class="literal">"EPSG:4269"</span>:case <span class="literal">"CRS:84"</span>:case <span class="literal">"EPSG:4965"</span>:case new String(<span class="literal">"http://www.opengis.net/gml/srs/epsg.xml#4326"</span>).toUpperCase():
      <span class="reserved">this</span>.Forward=identity;
      <span class="reserved">this</span>.Inverse=identity;
      <span class="reserved">this</span>.units=<span class="literal">"degrees"</span>;
      <span class="reserved">this</span>.title=<span class="literal">"Lat/Long"</span>;
      break;
    case <span class="literal">"EPSG:102758"</span>:<span class="reserved">this</span>.title=<span class="literal">"NAD 1983 StatePlane Wyoming West FIPS 4904 US Survey Feet"</span>;
      <span class="reserved">this</span>.Init=tminit;
      <span class="reserved">this</span>.Forward=ll2tm
      <span class="reserved">this</span>.Inverse=tm2ll;
      <span class="reserved">this</span>.Init(new Array(grs80[0], grs80[1], 0.9999375, -110.0833333333333, 40.5, 800000, 100000));
      <span class="reserved">this</span>.units=<span class="literal">"usfeet"</span>;
      break;
    case <span class="literal">"EPSG:32158"</span>:<span class="reserved">this</span>.title=<span class="literal">"NAD 1983 StatePlane Wyoming West meters"</span>;
      <span class="reserved">this</span>.Init=tminit;
      <span class="reserved">this</span>.Forward=ll2tm
      <span class="reserved">this</span>.Inverse=tm2ll;
      <span class="reserved">this</span>.Init(new Array(grs80[0], grs80[1], 0.9999375, -110.0833333333333, 40.5, 800000, 100000));
      <span class="reserved">this</span>.units=<span class="literal">"meters"</span>;
      break;
    case <span class="literal">"EPSG:28992"</span>:
      <span class="reserved">this</span>.title=<span class="literal">"Amersfoort / RD New"</span>;
      <span class="reserved">this</span>.Init=stint;
      <span class="reserved">this</span>.Forward=ll2st;
      <span class="reserved">this</span>.Inverse=st2ll;
      <span class="reserved">this</span>.Init(new Array(6377397.155, 5.38763888888889, 52.15616055555555, 155000, 463000));
      <span class="reserved">this</span>.units=<span class="literal">"meters"</span>;
    break;
<span class="comment">    // UTM NAD83 Zones 3 thru 23</span>
    case<span class="literal">"EPSG:26903"</span>:case<span class="literal">"EPSG:26904"</span>:case<span class="literal">"EPSG:26905"</span>:case<span class="literal">"EPSG:26906"</span>:case<span class="literal">"EPSG:26907"</span>:case<span class="literal">"EPSG:26908"</span>:case<span class="literal">"EPSG:26909"</span>:
    case<span class="literal">"EPSG:26910"</span>:case<span class="literal">"EPSG:26911"</span>:case<span class="literal">"EPSG:26912"</span>:case<span class="literal">"EPSG:26913"</span>:case<span class="literal">"EPSG:26914"</span>:case<span class="literal">"EPSG:26915"</span>:case<span class="literal">"EPSG:26916"</span>:
    case<span class="literal">"EPSG:26917"</span>:case<span class="literal">"EPSG:26918"</span>:case<span class="literal">"EPSG:26919"</span>:case<span class="literal">"EPSG:26920"</span>:case<span class="literal">"EPSG:26921"</span>:case<span class="literal">"EPSG:26922"</span>:case<span class="literal">"EPSG:26923"</span>:
      <span class="reserved">this</span>.title=<span class="literal">"NAD83 / UTM zone "</span>+ srs.substr(8,2)+<span class="literal">"N"</span>;
      <span class="reserved">this</span>.Init=utminit;
      <span class="reserved">this</span>.Forward=ll2tm;
      <span class="reserved">this</span>.Inverse=tm2ll;
      <span class="reserved">this</span>.Init(new Array(grs80[0], grs80[1], 0.9996, srs.substr(8,2)));
      <span class="reserved">this</span>.units=<span class="literal">"meters"</span>;
    break;
<span class="comment">    // UTM WGS84 Zones 1 thru 60 North</span>
    case<span class="literal">"EPSG:32601"</span>:case<span class="literal">"EPSG:32602"</span>:
    case<span class="literal">"EPSG:32603"</span>:case<span class="literal">"EPSG:32604"</span>:case<span class="literal">"EPSG:32605"</span>:case<span class="literal">"EPSG:32606"</span>:case<span class="literal">"EPSG:32607"</span>:case<span class="literal">"EPSG:32608"</span>:case<span class="literal">"EPSG:32609"</span>:
    case<span class="literal">"EPSG:32610"</span>:case<span class="literal">"EPSG:32611"</span>:case<span class="literal">"EPSG:32612"</span>:case<span class="literal">"EPSG:32613"</span>:case<span class="literal">"EPSG:32614"</span>:case<span class="literal">"EPSG:32615"</span>:case<span class="literal">"EPSG:32616"</span>:
    case<span class="literal">"EPSG:32617"</span>:case<span class="literal">"EPSG:32618"</span>:case<span class="literal">"EPSG:32619"</span>:case<span class="literal">"EPSG:32620"</span>:case<span class="literal">"EPSG:32621"</span>:case<span class="literal">"EPSG:32622"</span>:case<span class="literal">"EPSG:32623"</span>:
    case<span class="literal">"EPSG:32624"</span>:case<span class="literal">"EPSG:32625"</span>:case<span class="literal">"EPSG:32626"</span>:case<span class="literal">"EPSG:32627"</span>:case<span class="literal">"EPSG:32628"</span>:case<span class="literal">"EPSG:32629"</span>:
    case<span class="literal">"EPSG:32630"</span>:case<span class="literal">"EPSG:32631"</span>:case<span class="literal">"EPSG:32632"</span>:case<span class="literal">"EPSG:32633"</span>:case<span class="literal">"EPSG:32634"</span>:case<span class="literal">"EPSG:32635"</span>:case<span class="literal">"EPSG:32636"</span>:
    case<span class="literal">"EPSG:32637"</span>:case<span class="literal">"EPSG:32638"</span>:case<span class="literal">"EPSG:32639"</span>:case<span class="literal">"EPSG:32640"</span>:case<span class="literal">"EPSG:32641"</span>:case<span class="literal">"EPSG:32642"</span>:
    case<span class="literal">"EPSG:32643"</span>:case<span class="literal">"EPSG:32644"</span>:case<span class="literal">"EPSG:32645"</span>:case<span class="literal">"EPSG:32646"</span>:case<span class="literal">"EPSG:32647"</span>:case<span class="literal">"EPSG:32648"</span>:case<span class="literal">"EPSG:32649"</span>:
    case<span class="literal">"EPSG:32650"</span>:case<span class="literal">"EPSG:32651"</span>:case<span class="literal">"EPSG:32652"</span>:case<span class="literal">"EPSG:32653"</span>:case<span class="literal">"EPSG:32654"</span>:case<span class="literal">"EPSG:32655"</span>:case<span class="literal">"EPSG:32656"</span>:
    case<span class="literal">"EPSG:32657"</span>:case<span class="literal">"EPSG:32658"</span>:case<span class="literal">"EPSG:32659"</span>:case<span class="literal">"EPSG:32660"</span>:
      <span class="reserved">this</span>.title=<span class="literal">"WGS84 / UTM zone "</span> + srs.substr(8,2) + <span class="literal">"N"</span>;
      <span class="reserved">this</span>.Init=utminit;
      <span class="reserved">this</span>.Forward=ll2tm;
      <span class="reserved">this</span>.Inverse=tm2ll;
      <span class="reserved">this</span>.Init(new Array(wgs84[0], wgs84[1], 0.9996, srs.substr(8,2)));
      <span class="reserved">this</span>.units=<span class="literal">"meters"</span>;
    break;
<span class="comment">    // UTM WGS84 Zones 1 thru 60 South</span>
    case<span class="literal">"EPSG:32701"</span>:case<span class="literal">"EPSG:32702"</span>:
    case<span class="literal">"EPSG:32703"</span>:case<span class="literal">"EPSG:32704"</span>:case<span class="literal">"EPSG:32705"</span>:case<span class="literal">"EPSG:32706"</span>:case<span class="literal">"EPSG:32707"</span>:case<span class="literal">"EPSG:32708"</span>:case<span class="literal">"EPSG:32709"</span>:
    case<span class="literal">"EPSG:32710"</span>:case<span class="literal">"EPSG:32711"</span>:case<span class="literal">"EPSG:32712"</span>:case<span class="literal">"EPSG:32713"</span>:case<span class="literal">"EPSG:32714"</span>:case<span class="literal">"EPSG:32715"</span>:case<span class="literal">"EPSG:32716"</span>:
    case<span class="literal">"EPSG:32717"</span>:case<span class="literal">"EPSG:32718"</span>:case<span class="literal">"EPSG:32719"</span>:case<span class="literal">"EPSG:32720"</span>:case<span class="literal">"EPSG:32721"</span>:case<span class="literal">"EPSG:32722"</span>:case<span class="literal">"EPSG:32723"</span>:
    case<span class="literal">"EPSG:32724"</span>:case<span class="literal">"EPSG:32725"</span>:case<span class="literal">"EPSG:32726"</span>:case<span class="literal">"EPSG:32727"</span>:case<span class="literal">"EPSG:32728"</span>:case<span class="literal">"EPSG:32729"</span>:
    case<span class="literal">"EPSG:32730"</span>:case<span class="literal">"EPSG:32731"</span>:case<span class="literal">"EPSG:32732"</span>:case<span class="literal">"EPSG:32733"</span>:case<span class="literal">"EPSG:32734"</span>:case<span class="literal">"EPSG:32735"</span>:case<span class="literal">"EPSG:32736"</span>:
    case<span class="literal">"EPSG:32737"</span>:case<span class="literal">"EPSG:32738"</span>:case<span class="literal">"EPSG:32739"</span>:case<span class="literal">"EPSG:32740"</span>:case<span class="literal">"EPSG:32741"</span>:case<span class="literal">"EPSG:32742"</span>:
    case<span class="literal">"EPSG:32743"</span>:case<span class="literal">"EPSG:32744"</span>:case<span class="literal">"EPSG:32745"</span>:case<span class="literal">"EPSG:32746"</span>:case<span class="literal">"EPSG:32747"</span>:case<span class="literal">"EPSG:32748"</span>:case<span class="literal">"EPSG:32749"</span>:
    case<span class="literal">"EPSG:32750"</span>:case<span class="literal">"EPSG:32751"</span>:case<span class="literal">"EPSG:32752"</span>:case<span class="literal">"EPSG:32753"</span>:case<span class="literal">"EPSG:32754"</span>:case<span class="literal">"EPSG:32755"</span>:case<span class="literal">"EPSG:32756"</span>:
    case<span class="literal">"EPSG:32757"</span>:case<span class="literal">"EPSG:32758"</span>:case<span class="literal">"EPSG:32759"</span>:case<span class="literal">"EPSG:32760"</span>:
      <span class="reserved">this</span>.title=<span class="literal">"WGS84 / UTM zone "</span> + srs.substr(8,2) + <span class="literal">"S"</span>;
      <span class="reserved">this</span>.Init=utminit;
      <span class="reserved">this</span>.Forward=ll2tm;
      <span class="reserved">this</span>.Inverse=tm2ll;
      <span class="reserved">this</span>.Init(new Array(wgs84[0], wgs84[1], 0.9996, <span class="literal">"-"</span>+srs.substr(8,2)));
      <span class="reserved">this</span>.units=<span class="literal">"meters"</span>;
    break;
    case <span class="literal">"EPSG:26591"</span>:<span class="reserved">this</span>.title=<span class="literal">"Monte Mario (Rome) / Italy zone 1"</span>;
      <span class="reserved">this</span>.Init=tminit;
      <span class="reserved">this</span>.Forward=ll2tm
      <span class="reserved">this</span>.Inverse=tm2ll;
      <span class="reserved">this</span>.Init(new Array(6378388.0, 6356911.94612795,0.9996, 9, 0.0, 1500000.0, 0.0));
      <span class="reserved">this</span>.units=<span class="literal">"meters"</span>;
      break;
    case <span class="literal">"SCENE"</span>:             //<span class="reserved">this</span> is really a pixel projection with bilinear interpolation of the corners to get ll
      <span class="reserved">this</span>.Init = sceneInit;
      <span class="reserved">this</span>.Forward = ll2scene;
      <span class="reserved">this</span>.Inverse = scene2ll;
      <span class="reserved">this</span>.GetXYCoords = identity;  //override to get line 0 at top left
      <span class="reserved">this</span>.GetPLCoords = identity; //
      break;
    case <span class="literal">"PIXEL"</span>:
      <span class="reserved">this</span>.Forward = ll2pixel;
      <span class="reserved">this</span>.Inverse = pixel2ll;
      <span class="reserved">this</span>.units = <span class="literal">"pixels"</span>;
      <span class="reserved">this</span>.GetXYCoords = identity;  //override to get line 0 at top left
      <span class="reserved">this</span>.GetPLCoords = identity; //
      break;
    default:
<span class="comment">      //or retrieve parameters from web service based on SRS lookup</span>
      alert(<span class="literal">"unsupported map projection: "</span>+<span class="reserved">this</span>.srs);
  }

  <span class="reserved">this</span>.matchSrs = <span class="reserved">function</span>(otherSrs) {
    <span class="reserved">if</span> (<span class="reserved">this</span>.srs == otherSrs.toUpperCase() ) <span class="reserved">return</span> true;
    <span class="reserved">return</span> false;
  }

}

<span class="reserved">function</span> gmap_forward (coords) {
  <span class="reserved">return</span> config.objects.googleMapTools.getPixelsFromLatLong(coords);
}

<span class="reserved">function</span> gmap_inverse (coords) {
  <span class="reserved">return</span> config.objects.googleMapTools.getLatLongFromPixels(coords);
}

<span class="reserved">function</span> identity(coords) {
  <span class="reserved">return</span> coords;
}

<span class="comment">/**
 * Scene projection forward transformation.
 * Forward trasnformation need reverse bilinear interpolation or orbit modelling
 * (to be implemented)
 * <span class="attrib">@param</span> coords  Lat/Long coords passed in
 * <span class="attrib">@return</span> map coordinates
 */</span>
<span class="reserved">function</span> ll2scene(coords) {
  alert(<span class="literal">"ll2scene not defined"</span>);
<span class="comment">  //return new Array(124, 15+256);  //for testing only,</span>
  <span class="reserved">return</span> null;
}

<span class="comment">/**
 * Scene projection Inverse transformation.
 * This is really a pixel representation with bi-linear interpolation of the corner coords.
 * <span class="attrib">@param</span> coords  map coordinates passed in
 * <span class="attrib">@return</span> Lat/Long coords
 */</span>
<span class="reserved">function</span> scene2ll(coords) {
  var xpct = (coords[0]-<span class="reserved">this</span>.ul[0])/(<span class="reserved">this</span>.lr[0]-<span class="reserved">this</span>.ul[0]);
  var ypct = (coords[1]-<span class="reserved">this</span>.ul[1])/(<span class="reserved">this</span>.lr[1]-<span class="reserved">this</span>.ul[1]);
<span class="comment">//  alert("pct:"+xpct+":"+ypct);</span>
  var lon = bilinterp(xpct, ypct, <span class="reserved">this</span>.cul[0], <span class="reserved">this</span>.cur[0], <span class="reserved">this</span>.cll[0], <span class="reserved">this</span>.clr[0])
  var lat = bilinterp(xpct, ypct, <span class="reserved">this</span>.cul[1], <span class="reserved">this</span>.cur[1], <span class="reserved">this</span>.cll[1], <span class="reserved">this</span>.clr[1])
  <span class="reserved">return</span> new Array(lon, lat);
}

<span class="comment">/**
 * Scene projection initialization function
 * <span class="attrib">@param</span> param  array of the corner coordinates (which are in turn 2D point arrays)
 * in the order upper-left, upper-right, lower-left, lower-right
 */</span>
<span class="reserved">function</span> sceneInit(param) {
  <span class="reserved">this</span>.cul = param[0];
  <span class="reserved">this</span>.cur = param[1];
  <span class="reserved">this</span>.cll = param[2];
  <span class="reserved">this</span>.clr = param[3];
}

<span class="comment">/**
 * Bilinear interpolation function to return an interpolated value for either
 * x or y for some point located within a box where the XY of the corners are known.
 * This should be applied to the x and y coordinates separately,
 * ie. first interpolate for the x value, then the y.
 * the a,b,c,d params are thus the x or y values at the corners.
 * <span class="attrib">@param</span> x distance from the left side of the box as a percentage
 * <span class="attrib">@param</span> y distance from the top of the box as a percentage
 * <span class="attrib">@param</span> a either x or y value at the UL corner of the box
 * <span class="attrib">@param</span> b either x or y value at the UR corner of the box
 * <span class="attrib">@param</span> c either x or y value at the LL corner of the box
 * <span class="attrib">@param</span> d either x or y value at the LR corner of the box
 */</span>
<span class="reserved">function</span> bilinterp(x, y, a, b, c, d) {
  var top = x*(b-a) + a;
  var bot = x*(d-c) + c;
<span class="comment">//alert("top:"+top+"  bot:"+bot);</span>
  <span class="reserved">return</span> y*(bot-top) + top;
}
<span class="comment">
// pixel projection object definition</span>
<span class="comment">// a pixel representation</span>
<span class="comment">// forward transformation</span>
<span class="reserved">function</span> ll2pixel(coords) {
  alert(<span class="literal">"ll2pixel not defined"</span>);
  <span class="reserved">return</span> null;
}
<span class="comment">
// inverse transformation</span>
<span class="reserved">function</span> pixel2ll(coords) {
  alert(<span class="literal">"pixel2ll not defined"</span>);
<span class="comment">//  return new Array(lon, lat);</span>
  <span class="reserved">return</span> null;
}


<span class="comment">/****************************************************************************
The following code is a port the USGS GCTPC coordinate transformation code from
C to Javascript. For more information visit http://edcftp.cr.usgs.gov/pub/software/gctpc/
Currently suppported projections include: Lambert Conformal Conic (LCC),
Lat/Long, Polar Stereographic.
Porting C to Javascript is fairly straightforward so other support for more
projections is easy to add.
*/</span>

var PI = Math.PI;
var HALF_PI = PI*0.5;
var TWO_PI = PI*2.0;
var EPSLN = 1.0e-10;
var R2D = 57.2957795131;
var D2R =0.0174532925199;
var R = 6370997.0;        // Radius of the earth (sphere)
<span class="comment">

// Initialize the Lambert Conformal conic projection</span>
<span class="comment">// -----------------------------------------------------------------</span>
<span class="reserved">function</span> lccinit(param) {
<span class="comment">// array of:  r_maj,r_min,lat1,lat2,c_lon,c_lat,false_east,false_north</span>
<span class="comment">//double c_lat;                   /* center latitude                      */</span>
<span class="comment">//double c_lon;                   /* center longitude                     */</span>
<span class="comment">//double lat1;                    /* first standard parallel              */</span>
<span class="comment">//double lat2;                    /* second standard parallel             */</span>
<span class="comment">//double r_maj;                   /* major axis                           */</span>
<span class="comment">//double r_min;                   /* minor axis                           */</span>
<span class="comment">//double false_east;              /* x offset in meters                   */</span>
<span class="comment">//double false_north;             /* y offset in meters                   */</span>

  <span class="reserved">this</span>.r_major = param[0];
  <span class="reserved">this</span>.r_minor = param[1];
  var lat1 = param[2] * D2R;
  var lat2 = param[3] * D2R;
  <span class="reserved">this</span>.center_lon = param[4] * D2R;
  <span class="reserved">this</span>.center_lat = param[5] * D2R;
  <span class="reserved">this</span>.false_easting = param[6];
  <span class="reserved">this</span>.false_northing = param[7];
<span class="comment">
// Standard Parallels cannot be equal and on opposite sides of the equator</span>
  <span class="reserved">if</span> (Math.abs(lat1+lat2) &lt; EPSLN) {
    alert(<span class="literal">"Equal Latitiudes for St. Parallels on opposite sides of equator - lccinit"</span>);
    <span class="reserved">return</span>;
  }

  var temp = <span class="reserved">this</span>.r_minor / <span class="reserved">this</span>.r_major;
  <span class="reserved">this</span>.e = Math.sqrt(1.0 - temp*temp);

  var sin1 = Math.sin(lat1);
  var cos1 = Math.cos(lat1);
  var ms1 = msfnz(<span class="reserved">this</span>.e, sin1, cos1);
  var ts1 = tsfnz(<span class="reserved">this</span>.e, lat1, sin1);

  var sin2 = Math.sin(lat2);
  var cos2 = Math.cos(lat2);
  var ms2 = msfnz(<span class="reserved">this</span>.e, sin2, cos2);
  var ts2 = tsfnz(<span class="reserved">this</span>.e, lat2, sin2);

  var ts0 = tsfnz(<span class="reserved">this</span>.e, <span class="reserved">this</span>.center_lat, Math.sin(<span class="reserved">this</span>.center_lat));

  <span class="reserved">if</span> (Math.abs(lat1 - lat2) &gt; EPSLN) {
    <span class="reserved">this</span>.ns = Math.log(ms1/ms2)/Math.log(ts1/ts2);
  } <span class="reserved">else</span> {
    <span class="reserved">this</span>.ns = sin1;
  }
  <span class="reserved">this</span>.f0 = ms1 / (<span class="reserved">this</span>.ns * Math.pow(ts1, <span class="reserved">this</span>.ns));
  <span class="reserved">this</span>.rh = <span class="reserved">this</span>.r_major * <span class="reserved">this</span>.f0 * Math.pow(ts0, <span class="reserved">this</span>.ns);
}
<span class="comment">

// Lambert Conformal conic forward equations--mapping lat,long to x,y</span>
<span class="comment">// -----------------------------------------------------------------</span>
<span class="reserved">function</span> ll2lcc(coords) {

  var lon = coords[0];
  var lat = coords[1];
<span class="comment">
// convert to radians</span>
  <span class="reserved">if</span> ( lat &lt;= 90.0 &amp;&amp; lat &gt;= -90.0 &amp;&amp; lon &lt;= 180.0 &amp;&amp; lon &gt;= -180.0) {
    lat *= D2R;
    lon *= D2R;
  } <span class="reserved">else</span> {
    alert(<span class="literal">"*** Input out of range ***: lon: "</span>+lon+<span class="literal">" - lat: "</span>+lat);
    <span class="reserved">return</span> null;
  }

  var con  = Math.abs( Math.abs(lat) - HALF_PI);
  var ts;
  <span class="reserved">if</span> (con &gt; EPSLN) {
    ts = tsfnz(<span class="reserved">this</span>.e, lat, Math.sin(lat) );
    rh1 = <span class="reserved">this</span>.r_major * <span class="reserved">this</span>.f0 * Math.pow(ts, <span class="reserved">this</span>.ns);
  } <span class="reserved">else</span> {
    con = lat * <span class="reserved">this</span>.ns;
    <span class="reserved">if</span> (con &lt;= 0) {
      alert(<span class="literal">"Point can not be projected - ll2lcc"</span>);
      <span class="reserved">return</span> null;
    }
    rh1 = 0;
  }
  var theta = <span class="reserved">this</span>.ns * adjust_lon(lon - <span class="reserved">this</span>.center_lon);
  var x = rh1 * Math.sin(theta) + <span class="reserved">this</span>.false_easting;
  var y = <span class="reserved">this</span>.rh - rh1 * Math.cos(theta) + <span class="reserved">this</span>.false_northing;

  <span class="reserved">return</span> new Array(x,y);
}
<span class="comment">
// Lambert Conformal Conic inverse equations--mapping x,y to lat/long</span>
<span class="comment">// -----------------------------------------------------------------</span>
<span class="reserved">function</span> lcc2ll(coords) {

  var rh1, con, ts;
  var lat, lon;
  x = coords[0] - <span class="reserved">this</span>.false_easting;
  y = <span class="reserved">this</span>.rh - coords[1] + <span class="reserved">this</span>.false_northing;
  <span class="reserved">if</span> (<span class="reserved">this</span>.ns &gt; 0) {
    rh1 = Math.sqrt (x * x + y * y);
    con = 1.0;
  } <span class="reserved">else</span> {
    rh1 = -Math.sqrt (x * x + y * y);
    con = -1.0;
  }
  var theta = 0.0;
  <span class="reserved">if</span> (rh1 != 0) {
    theta = Math.atan2((con * x),(con * y));
  }
  <span class="reserved">if</span> ((rh1 != 0) || (<span class="reserved">this</span>.ns &gt; 0.0)) {
    con = 1.0/<span class="reserved">this</span>.ns;
    ts = Math.pow((rh1/(<span class="reserved">this</span>.r_major * <span class="reserved">this</span>.f0)), con);
    lat = phi2z(<span class="reserved">this</span>.e, ts);
    <span class="reserved">if</span> (lat == -9999) <span class="reserved">return</span> null;
  } <span class="reserved">else</span> {
    lat = -HALF_PI;
  }
  lon = adjust_lon(theta/<span class="reserved">this</span>.ns + <span class="reserved">this</span>.center_lon);
  <span class="reserved">return</span> new Array(R2D*lon, R2D*lat);
}
<span class="comment">
//*******************************************************************************</span>
<span class="comment">//NAME                            POLAR STEREOGRAPHIC</span>
<span class="comment">// converted from the GCTPC package</span>
<span class="comment">//* Variables common to all subroutines in this code file</span>
<span class="comment">//  static double r_major;    /* major axis     */</span>
<span class="comment">//  static double r_minor;    /* minor axis     */</span>
<span class="comment">//  static double e;      /* eccentricity     */</span>
<span class="comment">//  static double e4;     /* e4 calculated from eccentricity*/</span>
<span class="comment">//  static double center_lon;   /* center longitude   */</span>
<span class="comment">//  static double center_lat;   /* center latitude    */</span>
<span class="comment">//  static double fac;      /* sign variable    */</span>
<span class="comment">//  static double ind;      /* flag variable    */</span>
<span class="comment">//  static double mcs;      /* small m      */</span>
<span class="comment">//  static double tcs;      /* small t      */</span>
<span class="comment">//  static double false_northing;   /* y offset in meters   */</span>
<span class="comment">//  static double false_easting;    /* x offset in meters   */</span>
<span class="comment">

//* Initialize the Polar Stereographic projection</span>
<span class="reserved">function</span> psinit(param) {
<span class="comment">// array consisting of:  r_maj,r_min,c_lon,c_lat,false_east,false_north)</span>
<span class="comment">//double c_lon;       /* center longitude in degrees  */</span>
<span class="comment">//double c_lat;       /* center latitude in degrees   */</span>
<span class="comment">//double r_maj;       /* major axis     */</span>
<span class="comment">//double r_min;       /* minor axis     */</span>
<span class="comment">//double false_east;      /* x offset in meters   */</span>
<span class="comment">//double false_north;     /* y offset in meters   */</span>

  <span class="reserved">this</span>.r_major = param[0];
  <span class="reserved">this</span>.r_minor = param[1];
  <span class="reserved">this</span>.center_lon = param[2] * D2R;
  <span class="reserved">this</span>.center_lat = param[3] * D2R;
  <span class="reserved">this</span>.false_easting = param[4];
  <span class="reserved">this</span>.false_northing = param[5];

  var temp = <span class="reserved">this</span>.r_minor / <span class="reserved">this</span>.r_major;
  <span class="reserved">this</span>.e = 1.0 - temp*temp;
  <span class="reserved">this</span>.e = Math.sqrt(<span class="reserved">this</span>.e);
  var con = 1.0 + <span class="reserved">this</span>.e;
  var com = 1.0 - <span class="reserved">this</span>.e;
  <span class="reserved">this</span>.e4 = Math.sqrt( Math.pow(con,con) * Math.pow(com,com) );
  <span class="reserved">this</span>.fac = (<span class="reserved">this</span>.center_lat &lt; 0) ? -1.0 : 1.0;
  <span class="reserved">this</span>.ind = 0;
  <span class="reserved">if</span> (Math.abs(Math.abs(<span class="reserved">this</span>.center_lat) - HALF_PI) &gt; EPSLN) {
    <span class="reserved">this</span>.ind = 1;
    var con1 = <span class="reserved">this</span>.fac * <span class="reserved">this</span>.center_lat;
    var sinphi = Math.sin(con1);
    <span class="reserved">this</span>.mcs = msfnz(<span class="reserved">this</span>.e, sinphi, Math.cos(con1));
    <span class="reserved">this</span>.tcs = tsfnz(<span class="reserved">this</span>.e, con1, sinphi);
  }
}
<span class="comment">
//* Polar Stereographic forward equations--mapping lat,long to x,y</span>
<span class="comment">//  --------------------------------------------------------------*/</span>
<span class="reserved">function</span> ll2ps(coords) {

  var lon = coords[0];
  var lat = coords[1];

  var con1 = <span class="reserved">this</span>.fac * adjust_lon(lon - <span class="reserved">this</span>.center_lon);
  var con2 = <span class="reserved">this</span>.fac * lat;
  var sinphi = Math.sin(con2);
  var ts = tsfnz(<span class="reserved">this</span>.e, con2, sinphi);
  <span class="reserved">if</span> (<span class="reserved">this</span>.ind != 0) {
    rh = <span class="reserved">this</span>.r_major * <span class="reserved">this</span>.mcs * ts / <span class="reserved">this</span>.tcs;
  } <span class="reserved">else</span> {
    rh = 2.0 * <span class="reserved">this</span>.r_major * ts / <span class="reserved">this</span>.e4;
  }
  var x = <span class="reserved">this</span>.fac * rh * Math.sin(con1) + <span class="reserved">this</span>.false_easting;
  var y = -<span class="reserved">this</span>.fac * rh * Math.cos(con1) + <span class="reserved">this</span>.false_northing;;

  <span class="reserved">return</span> new Array(x,y);
}
<span class="comment">
//* Polar Stereographic inverse equations--mapping x,y to lat/long</span>
<span class="comment">//  --------------------------------------------------------------*/</span>
<span class="reserved">function</span> ps2ll(coords) {

  x = (coords[0] - <span class="reserved">this</span>.false_easting) * <span class="reserved">this</span>.fac;
  y = (coords[1] - <span class="reserved">this</span>.false_northing) * <span class="reserved">this</span>.fac;
  var rh = Math.sqrt(x * x + y * y);
  <span class="reserved">if</span> (<span class="reserved">this</span>.ind != 0) {
    ts = rh * <span class="reserved">this</span>.tcs/(<span class="reserved">this</span>.r_major * <span class="reserved">this</span>.mcs);
  } <span class="reserved">else</span> {
    ts = rh * <span class="reserved">this</span>.e4/(<span class="reserved">this</span>.r_major * 2.0);
  }
  var lat = <span class="reserved">this</span>.fac * phi2z(<span class="reserved">this</span>.e, ts);
  <span class="reserved">if</span> (lat == -9999) <span class="reserved">return</span> null;
  var lon = 0;
  <span class="reserved">if</span> (rh == 0) {
    lon = <span class="reserved">this</span>.fac * <span class="reserved">this</span>.center_lon;
  } <span class="reserved">else</span> {
    lon = adjust_lon(<span class="reserved">this</span>.fac * Math.atan2(x, -y) + <span class="reserved">this</span>.center_lon);
  }
  <span class="reserved">return</span> new Array(R2D*lon, R2D*lat);
}
<span class="comment">
// following constants added by Greenwood</span>
<span class="reserved">function</span> semi_minor(a, f) { <span class="reserved">return</span> a-(a*(1/f)); }

var grs80  = new Array(6378137.0, 6356752.31414036); // r_maj, r_min
var wgs84  = new Array(6378137.0, 6356752.31424518);
var wgs72  = new Array(6378135.0, 6356750.52001609);
var intl  = new Array(6378388.0, 6356911.94612795); // (f=297) from ESRI

var usfeet = 1200/3937;  // US Survey foot
var feet = 0.3048;  // International foot
<span class="comment">
// following functions from gctpc cproj.c for transverse mercator projections</span>
<span class="reserved">function</span> e0fn(x){<span class="reserved">return</span>(1.0-0.25*x*(1.0+x/16.0*(3.0+1.25*x)));}
<span class="reserved">function</span> e1fn(x){<span class="reserved">return</span>(0.375*x*(1.0+0.25*x*(1.0+0.46875*x)));}
<span class="reserved">function</span> e2fn(x){<span class="reserved">return</span>(0.05859375*x*x*(1.0+0.75*x));}
<span class="reserved">function</span> e3fn(x){<span class="reserved">return</span>(x*x*x*(35.0/3072.0));}
<span class="reserved">function</span> mlfn(e0,e1,e2,e3,phi){<span class="reserved">return</span>(e0*phi-e1*Math.sin(2.0*phi)+e2*Math.sin(4.0*phi)-e3*Math.sin(6.0*phi));}

<span class="comment">/**
  Initialize Transverse Mercator projection
*/</span>
<span class="reserved">function</span> tminit(param)  {
  <span class="reserved">this</span>.r_maj=param[0];
  <span class="reserved">this</span>.r_min=param[1];
  <span class="reserved">this</span>.scale_fact=param[2];
  <span class="reserved">this</span>.lon_center=param[3]*D2R;
  <span class="reserved">this</span>.lat_origin=param[4]*D2R;
  <span class="reserved">this</span>.false_easting=param[5];
  <span class="reserved">this</span>.false_northing=param[6];
  var temp = <span class="reserved">this</span>.r_min / <span class="reserved">this</span>.r_maj;
  <span class="reserved">this</span>.es = 1.0 - Math.pow(temp,2);
<span class="comment">//  this.e = Math.sqrt(this.es);</span>
  <span class="reserved">this</span>.e0 = e0fn(<span class="reserved">this</span>.es);
  <span class="reserved">this</span>.e1 = e1fn(<span class="reserved">this</span>.es);
  <span class="reserved">this</span>.e2 = e2fn(<span class="reserved">this</span>.es);
  <span class="reserved">this</span>.e3 = e3fn(<span class="reserved">this</span>.es);
  <span class="reserved">this</span>.ml0 = <span class="reserved">this</span>.r_maj * mlfn(<span class="reserved">this</span>.e0, <span class="reserved">this</span>.e1, <span class="reserved">this</span>.e2, <span class="reserved">this</span>.e3, <span class="reserved">this</span>.lat_origin);
  <span class="reserved">this</span>.esp = <span class="reserved">this</span>.es / (1.0 - <span class="reserved">this</span>.es);
  <span class="reserved">this</span>.ind = (<span class="reserved">this</span>.es &lt; .00001) ? 1 : 0;
}

<span class="comment">/**
  Initialize UTM projection
*/</span>
<span class="reserved">function</span> utminit(param) {
  <span class="reserved">this</span>.r_maj=param[0];
  <span class="reserved">this</span>.r_min=param[1];
  <span class="reserved">this</span>.scale_fact=param[2];
  var zone=param[3];
  <span class="reserved">this</span>.lat_origin = 0.0;
  <span class="reserved">this</span>.lon_center = ((6 * Math.abs(zone)) - 183) * D2R;
  <span class="reserved">this</span>.false_easting = 500000.0;
  <span class="reserved">this</span>.false_northing = (zone &lt; 0) ? 10000000.0 : 0.0;
  var temp = <span class="reserved">this</span>.r_min / <span class="reserved">this</span>.r_maj;
  <span class="reserved">this</span>.es = 1.0 - Math.pow(temp,2);
<span class="comment">//  this.e = Math.sqrt(this.es);</span>
  <span class="reserved">this</span>.e0 = e0fn(<span class="reserved">this</span>.es);
  <span class="reserved">this</span>.e1 = e1fn(<span class="reserved">this</span>.es);
  <span class="reserved">this</span>.e2 = e2fn(<span class="reserved">this</span>.es);
  <span class="reserved">this</span>.e3 = e3fn(<span class="reserved">this</span>.es);
  <span class="reserved">this</span>.ml0 = <span class="reserved">this</span>.r_maj * mlfn(<span class="reserved">this</span>.e0, <span class="reserved">this</span>.e1, <span class="reserved">this</span>.e2, <span class="reserved">this</span>.e3, <span class="reserved">this</span>.lat_origin);
  <span class="reserved">this</span>.esp = <span class="reserved">this</span>.es / (1.0 - <span class="reserved">this</span>.es);
  <span class="reserved">this</span>.ind = (<span class="reserved">this</span>.es &lt; .00001) ? 1 : 0;
} // utminit()

<span class="comment">/**
  Transverse Mercator Forward  - long/lat to x/y
*/</span>
<span class="reserved">function</span> ll2tm(coords) {
  var lon=coords[0]*D2R;
  var lat=coords[1]*D2R;
  var delta_lon = adjust_lon(lon - <span class="reserved">this</span>.lon_center); <span class="comment">/* Delta longitude (Given longitude - center  */</span>
  var con;    <span class="comment">/* cone constant */</span>
  var x, y;
  var sin_phi=Math.sin(lat);
  var cos_phi=Math.cos(lat);

  <span class="reserved">if</span> (<span class="reserved">this</span>.ind != 0) {
    var b = cos_phi * Math.sin(delta_lon);
    <span class="reserved">if</span> ((Math.abs(Math.abs(b) - 1.0)) &lt; .0000000001)  {
      alert(<span class="literal">"Error in ll2tm(): Point projects into infinity"</span>);
      <span class="reserved">return</span>(93);
    } <span class="reserved">else</span> {
      x = .5 * <span class="reserved">this</span>.r_maj * <span class="reserved">this</span>.scale_fact * Math.log((1.0 + b)/(1.0 - b));
      con = Math.acos(cos_phi * Math.cos(delta_lon)/Math.sqrt(1.0 - b*b));
      <span class="reserved">if</span> (lat &lt; 0)
        con = - con;
      y = <span class="reserved">this</span>.r_maj * <span class="reserved">this</span>.scale_fact * (con - <span class="reserved">this</span>.lat_origin);
    }
  } <span class="reserved">else</span> {
    var al  = cos_phi * delta_lon;
    var als = Math.pow(al,2);
    var c   = <span class="reserved">this</span>.esp * Math.pow(cos_phi,2);
    var tq  = Math.tan(lat);
    var t   = Math.pow(tq,2);
    con = 1.0 - <span class="reserved">this</span>.es * Math.pow(sin_phi,2);
    var n   = <span class="reserved">this</span>.r_maj / Math.sqrt(con);
    var ml  = <span class="reserved">this</span>.r_maj * mlfn(<span class="reserved">this</span>.e0, <span class="reserved">this</span>.e1, <span class="reserved">this</span>.e2, <span class="reserved">this</span>.e3, lat);

    x = <span class="reserved">this</span>.scale_fact * n * al * (1.0 + als / 6.0 * (1.0 - t + c + als / 20.0 * (5.0 - 18.0 * t + Math.pow(t,2) + 72.0 * c - 58.0 * <span class="reserved">this</span>.esp))) + <span class="reserved">this</span>.false_easting;
    y = <span class="reserved">this</span>.scale_fact * (ml - <span class="reserved">this</span>.ml0 + n * tq * (als * (0.5 + als / 24.0 * (5.0 - t + 9.0 * c + 4.0 * Math.pow(c,2) + als / 30.0 * (61.0 - 58.0 * t + Math.pow(t,2) + 600.0 * c - 330.0 * <span class="reserved">this</span>.esp))))) + <span class="reserved">this</span>.false_northing;

    switch(<span class="reserved">this</span>.units){
      case <span class="literal">"usfeet"</span>:
        x /= usfeet;
        y /= usfeet
        break;
      case <span class="literal">"feet"</span>:
        x = x / feet;
        y = y / feet;
        break;
    } // switch()
  }
  <span class="reserved">return</span> new Array(x,y);
} // ll2tm()

<span class="comment">/**
  Transverse Mercator Inverse  -  x/y to long/lat
*/</span>
<span class="reserved">function</span> tm2ll(coords) {
  var x=coords[0];
  var y=coords[1];
  var con, phi;  <span class="comment">/* temporary angles       */</span>
  var delta_phi; <span class="comment">/* difference between longitudes    */</span>
  var i;
  var max_iter = 6;      <span class="comment">/* maximun number of iterations */</span>
  var lat, lon;

  <span class="reserved">if</span> (<span class="reserved">this</span>.ind != 0) {   <span class="comment">/* spherical form */</span>
    var f = exp(x/(<span class="reserved">this</span>.r_maj * <span class="reserved">this</span>.scale_fact));
    var g = .5 * (f - 1/f);
    var temp = <span class="reserved">this</span>.lat_origin + y/(<span class="reserved">this</span>.r_maj * <span class="reserved">this</span>.scale_fact);
    var h = cos(temp);
    con = sqrt((1.0 - h * h)/(1.0 + g * g));
    lat = asinz(con);
    <span class="reserved">if</span> (temp &lt; 0)
      lat = -lat;
    <span class="reserved">if</span> ((g == 0) &amp;&amp; (h == 0)) {
      lon = <span class="reserved">this</span>.lon_center;
    } <span class="reserved">else</span> {
      lon = adjust_lon(atan2(g,h) + <span class="reserved">this</span>.lon_center);
    }
  } <span class="reserved">else</span> {    // ellipsoidal form
    x = x - <span class="reserved">this</span>.false_easting;
    y = y - <span class="reserved">this</span>.false_northing;

    con = (<span class="reserved">this</span>.ml0 + y / <span class="reserved">this</span>.scale_fact) / <span class="reserved">this</span>.r_maj;
    phi = con;
    <span class="reserved">for</span> (i=0;;i++) {
      delta_phi=((con + <span class="reserved">this</span>.e1 * Math.sin(2.0*phi) - <span class="reserved">this</span>.e2 * Math.sin(4.0*phi) + <span class="reserved">this</span>.e3 * Math.sin(6.0*phi)) / <span class="reserved">this</span>.e0) - phi;
      phi += delta_phi;
      <span class="reserved">if</span> (Math.abs(delta_phi) &lt;= EPSLN) break;
      <span class="reserved">if</span> (i &gt;= max_iter) {
        alert (<span class="literal">"Error in tm2ll(): Latitude failed to converge"</span>);
        <span class="reserved">return</span>(95);
      }
    } // <span class="reserved">for</span>()
    <span class="reserved">if</span> (Math.abs(phi) &lt; HALF_PI) {
<span class="comment">      // sincos(phi, &amp;sin_phi, &amp;cos_phi);</span>
      var sin_phi=Math.sin(phi);
      var cos_phi=Math.cos(phi);
      var tan_phi = Math.tan(phi);
      var c = <span class="reserved">this</span>.esp * Math.pow(cos_phi,2);
      var cs = Math.pow(c,2);
      var t = Math.pow(tan_phi,2);
      var ts = Math.pow(t,2);
      con = 1.0 - <span class="reserved">this</span>.es * Math.pow(sin_phi,2);
      var n = <span class="reserved">this</span>.r_maj / Math.sqrt(con);
      var r = n * (1.0 - <span class="reserved">this</span>.es) / con;
      var d = x / (n * <span class="reserved">this</span>.scale_fact);
      var ds = Math.pow(d,2);
      lat = phi - (n * tan_phi * ds / r) * (0.5 - ds / 24.0 * (5.0 + 3.0 * t + 10.0 * c - 4.0 * cs - 9.0 * <span class="reserved">this</span>.esp - ds / 30.0 * (61.0 + 90.0 * t + 298.0 * c + 45.0 * ts - 252.0 * <span class="reserved">this</span>.esp - 3.0 * cs)));
      lon = adjust_lon(<span class="reserved">this</span>.lon_center + (d * (1.0 - ds / 6.0 * (1.0 + 2.0 * t + c - ds / 20.0 * (5.0 - 2.0 * c + 28.0 * t - 3.0 * cs + 8.0 * <span class="reserved">this</span>.esp + 24.0 * ts))) / cos_phi));
    } <span class="reserved">else</span> {
      lat = HALF_PI * sign(y);
      lon = <span class="reserved">this</span>.lon_center;
    }
  }
  <span class="reserved">return</span> new Array(lon*R2D, lat*R2D);
} // tm2ll()
<span class="comment">

// Function to compute the constant small m which is the radius of</span>
<span class="comment">//   a parallel of latitude, phi, divided by the semimajor axis.</span>
<span class="comment">// -----------------------------------------------------------------</span>
<span class="reserved">function</span> msfnz(eccent, sinphi, cosphi) {
      var con = eccent * sinphi;
      <span class="reserved">return</span> cosphi/(Math.sqrt(1.0 - con * con));
}
<span class="comment">
// Function to compute the constant small t for use in the forward</span>
<span class="comment">//   computations in the Lambert Conformal Conic and the Polar</span>
<span class="comment">//   Stereographic projections.</span>
<span class="comment">// -----------------------------------------------------------------</span>
<span class="reserved">function</span> tsfnz(eccent, phi, sinphi) {
  var con = eccent * sinphi;
  var com = .5 * eccent;
  con = Math.pow(((1.0 - con) / (1.0 + con)), com);
  <span class="reserved">return</span> (Math.tan(.5 * (HALF_PI - phi))/con);
}
<span class="comment">

// Function to compute the latitude angle, phi2, for the inverse of the</span>
<span class="comment">//   Lambert Conformal Conic and Polar Stereographic projections.</span>
<span class="comment">// ----------------------------------------------------------------</span>
<span class="reserved">function</span> phi2z(eccent, ts) {
  var eccnth = .5 * eccent;
  var con, dphi;
  var phi = HALF_PI - 2 * Math.atan(ts);
  <span class="reserved">for</span> (i = 0; i &lt;= 15; i++) {
    con = eccent * Math.sin(phi);
    dphi = HALF_PI - 2 * Math.atan(ts *(Math.pow(((1.0 - con)/(1.0 + con)),eccnth))) - phi;
    phi += dphi;
    <span class="reserved">if</span> (Math.abs(dphi) &lt;= .0000000001) <span class="reserved">return</span> phi;
  }
  alert(<span class="literal">"Convergence error - phi2z"</span>);
  <span class="reserved">return</span> -9999;
}
<span class="comment">
// Function to return the sign of an argument</span>
<span class="reserved">function</span> sign(x) { <span class="reserved">if</span> (x &lt; 0.0) <span class="reserved">return</span>(-1); <span class="reserved">else</span> <span class="reserved">return</span>(1);}
<span class="comment">
// Function to adjust longitude to -180 to 180; input in radians</span>
<span class="reserved">function</span> adjust_lon(x) {x=(Math.abs(x)&lt;PI)?x:(x-(sign(x)*TWO_PI));<span class="reserved">return</span>(x);}
<span class="comment">

// Initialize the Stereographic projection</span>

<span class="reserved">function</span> stint(param) {
<span class="comment">  //array consisting of:</span>
<span class="comment">  //double r_maj;         /* major axis           */</span>
<span class="comment">  //double center_lon;    /* center longitude     */</span>
<span class="comment">  //double center_lat;    /* center latitude      */</span>
<span class="comment">  //double false_east;    /* x offset in meters   */</span>
<span class="comment">  //double false_north;   /* y offset in meters   */</span>

  <span class="reserved">this</span>.r_major = param[0];
  <span class="reserved">this</span>.lon_center = param[1] * D2R;
  <span class="reserved">this</span>.lat_center = param[2] * D2R;
  <span class="reserved">this</span>.false_easting = param[3];
  <span class="reserved">this</span>.false_northing = param[4];
<span class="comment">  // sincos(center_lat,&amp;sin_p10,&amp;cos_p10);</span>
  <span class="reserved">this</span>.sin_p10=Math.sin(<span class="reserved">this</span>.lat_center);
  <span class="reserved">this</span>.cos_p10=Math.cos(<span class="reserved">this</span>.lat_center);
} // stint()
<span class="comment">

// Stereographic forward equations--mapping lat,long to x,y</span>
<span class="reserved">function</span> ll2st(coords) {
  var lon = coords[0];
  var lat = coords[1];
  var ksp;              <span class="comment">/* scale factor               */</span>
<span class="comment">
// convert to radians</span>
  <span class="reserved">if</span> ( lat &lt;= 90.0 &amp;&amp; lat &gt;= -90.0 &amp;&amp; lon &lt;= 180.0 &amp;&amp; lon &gt;= -180.0) {
    lat *= D2R;
    lon *= D2R;
  } <span class="reserved">else</span> {
    alert(<span class="literal">"Error. Input out of range: lon: "</span>+lon+<span class="literal">" - lat: "</span>+lat);
    <span class="reserved">return</span> null;
  }
  var dlon = adjust_lon(lon - <span class="reserved">this</span>.lon_center);
<span class="comment">  // sincos(lat,&amp;sinphi,&amp;cosphi);</span>
  var sinphi=Math.sin(lat);
  var cosphi=Math.cos(lat);
  var coslon = Math.cos(dlon);
  var g = <span class="reserved">this</span>.sin_p10 * sinphi + <span class="reserved">this</span>.cos_p10 * cosphi * coslon;
  <span class="reserved">if</span> (Math.abs(g + 1.0) &lt;= EPSLN) {
    alert(<span class="literal">"Error. Point projects into infinity - st2ll()"</span>);
    <span class="reserved">return</span> null;
  } <span class="reserved">else</span> {
    ksp = 2.0 / (1.0 + g);
    var x = <span class="reserved">this</span>.false_easting + <span class="reserved">this</span>.r_major * ksp * cosphi * Math.sin(dlon);
    var y = <span class="reserved">this</span>.false_northing + <span class="reserved">this</span>.r_major * ksp * (<span class="reserved">this</span>.cos_p10 * sinphi - <span class="reserved">this</span>.sin_p10 * cosphi * coslon);
    <span class="reserved">return</span> new Array(x,y);
  }
} // ll2st()
<span class="comment">

//* Stereographic inverse equations--mapping x,y to lat/long</span>
<span class="reserved">function</span> st2ll(coords) {
  var x = (coords[0] - <span class="reserved">this</span>.false_easting);
  var y = (coords[1] - <span class="reserved">this</span>.false_northing);
  var rh = Math.sqrt(x * x + y * y);                  <span class="comment">/* height above ellipsoid */</span>
  var z = 2.0 * Math.atan(rh / (2.0 * <span class="reserved">this</span>.r_major)); <span class="comment">/* angle                  */</span>
<span class="comment">  //sincos(z,&amp;sinz,&amp;cosz);</span>
  var sinz=Math.sin(z);
  var cosz=Math.cos(z);
  var lat;
  var lon = <span class="reserved">this</span>.lon_center;
  <span class="reserved">if</span> (Math.abs(rh) &lt;= EPSLN) {
     lat = <span class="reserved">this</span>.lat_center;
  } <span class="reserved">else</span> {
     lat = Math.asin(cosz * <span class="reserved">this</span>.sin_p10 + (y * sinz * <span class="reserved">this</span>.cos_p10) / rh);
     var con = Math.abs(<span class="reserved">this</span>.lat_center) - HALF_PI;
     <span class="reserved">if</span> (Math.abs(con) &lt;= EPSLN) {
       <span class="reserved">if</span> (<span class="reserved">this</span>.lat_center &gt;= 0.0) {
         lon = adjust_lon(lon_center + atan2(x, -y));
<span class="comment">         /// return(OK);</span>
       } <span class="reserved">else</span> {
         lon = adjust_lon(lon_center - atan2(-x, y));
<span class="comment">         // return(OK);</span>
       }
     } <span class="reserved">else</span> {
       con = cosz - <span class="reserved">this</span>.sin_p10 * Math.sin(lat);
       <span class="reserved">if</span> ((Math.abs(con) &lt; EPSLN) &amp;&amp; (Math.abs(x) &lt; EPSLN))  {
<span class="comment">          // return(OK);</span>
       } <span class="reserved">else</span> {
         lon = adjust_lon(<span class="reserved">this</span>.lon_center + Math.atan2((x * sinz * <span class="reserved">this</span>.cos_p10), (con * rh)));
       }
     }
   }
  <span class="reserved">return</span> new Array(R2D*lon, R2D*lat);
} // st2ll()

<span class="comment">/*******************************************************************************
NAME                            MERCATOR

PURPOSE:	Transforms input longitude and latitude to Easting and
		Northing for the Mercator projection.  The
		longitude and latitude must be in radians.  The Easting
		and Northing values will be returned in meters.
		
The following code is a port the USGS GCTPC coordinate transformation code from
C to Javascript. For more information visit http://edcftp.cr.usgs.gov/pub/software/gctpc/
Currently suppported projections include: Lambert Conformal Conic (LCC),
Lat/Long, Polar Stereographic, Mercator and some others.
Porting C to Javascript is fairly straightforward so other support for more
projections is easy to add.

*******************************************************************************/</span>
<span class="comment">
//static double r_major;		/* major axis 				*/</span>
<span class="comment">//static double r_minor;		/* minor axis 				*/</span>
<span class="comment">//static double lon_center;	/* Center longitude (projection center) */</span>
<span class="comment">//static double lat_origin;	/* center latitude			*/</span>
<span class="comment">//static double e,es;		/* eccentricity constants		*/</span>
<span class="comment">//static double m1;		/* small value m			*/</span>
<span class="comment">//static double false_northing;	/* y offset in meters			*/</span>
<span class="comment">//static double false_easting;	/* x offset in meters			*/</span>

<span class="comment">/* Initialize the Mercator projection
  -------------------------------------------------*/</span>
<span class="reserved">function</span> minit(param)
{
	<span class="reserved">this</span>.r_major = param[0];
	<span class="reserved">this</span>.r_minor = param[1];
	<span class="reserved">this</span>.lon_center = param[2];
	<span class="reserved">this</span>.lat_origin = param[3];
	<span class="reserved">this</span>.false_northing = param[4];
	<span class="reserved">this</span>.false_easting = param[5];
	<span class="reserved">this</span>.temp = <span class="reserved">this</span>.r_minor / <span class="reserved">this</span>.r_major;
	<span class="reserved">this</span>.es=1.0 - Math.sqrt(<span class="reserved">this</span>.temp);
	<span class="reserved">this</span>.e = Math.sqrt( <span class="reserved">this</span>.es );
	<span class="reserved">this</span>.m1 = Math.cos(<span class="reserved">this</span>.lat_origin) / (Math.sqrt( 1.0 - <span class="reserved">this</span>.es * Math.sin(<span class="reserved">this</span>.lat_origin) * Math.sin(<span class="reserved">this</span>.lat_origin)));

}

<span class="comment">/* Mercator forward equations--mapping lat,long to x,y
  --------------------------------------------------*/</span>

<span class="reserved">function</span> ll2m(coords)
{	//alert(<span class="literal">"ll2m coords : "</span>+coords);
	var lon=coords[0];
	var lat=coords[1];
<span class="comment">	
	// convert to radians</span>
  	<span class="reserved">if</span> ( lat &lt;= 90.0 &amp;&amp; lat &gt;= -90.0 &amp;&amp; lon &lt;= 180.0 &amp;&amp; lon &gt;= -180.0) 
  	{
    	lat *= D2R;
    	lon *= D2R;
  	} 
  	<span class="reserved">else</span> 
  	{
    	alert(<span class="literal">"*** Input out of range ***: lon: "</span>+lon+<span class="literal">" - lat: "</span>+lat);
    	<span class="reserved">return</span> null;
  	}
  	
	<span class="reserved">if</span>(Math.abs( Math.abs(lat) - HALF_PI)  &lt;= EPSLN)
	{
		alert(<span class="literal">"Transformation cannot be computed at the poles"</span>);
		<span class="reserved">return</span> null;
	}
	<span class="reserved">else</span>
	{
		var sinphi = Math.sin(lat);
		var ts = tsfnz(<span class="reserved">this</span>.e,lat,sinphi);
		var x = <span class="reserved">this</span>.false_easting + <span class="reserved">this</span>.r_major * <span class="reserved">this</span>.m1 * adjust_lon(lon - <span class="reserved">this</span>.lon_center);
		var y = <span class="reserved">this</span>.false_northing - <span class="reserved">this</span>.r_major * <span class="reserved">this</span>.m1 * Math.log(ts);
	}
	<span class="reserved">return</span> new Array(x,y);
}


<span class="comment">/* Mercator inverse equations--mapping x,y to lat/long
  --------------------------------------------------*/</span>
<span class="reserved">function</span> m2ll(coords)
{	
	var x = coords[0];
	var y = coords[1];

	x -= <span class="reserved">this</span>.false_easting;
	y -= <span class="reserved">this</span>.false_northing
		
	var ts = Math.exp(-y / (<span class="reserved">this</span>.r_major * <span class="reserved">this</span>.m1));
	
	var lat = phi2z(<span class="reserved">this</span>.e,ts);
	<span class="reserved">if</span>(lat == -9999){alert(<span class="literal">"lat = -9999"</span>);<span class="reserved">return</span> null;}
	var lon = adjust_lon(<span class="reserved">this</span>.lon_center + x / (<span class="reserved">this</span>.r_major * <span class="reserved">this</span>.m1));
	
	<span class="reserved">return</span> new Array(R2D*lon,R2D*lat);
}
</pre>
	<hr>



<!-- ========== START OF NAVBAR ========== -->
<a name="navbar_top"><!-- --></a>
<table border="0" width="100%" cellpadding="1" cellspacing="0">
<tr>
<td colspan=2 bgcolor="#EEEEFF" class="NavBarCell1">
<a name="navbar_top_firstrow"><!-- --></a>
<table border="0" cellpadding="0" cellspacing="3">
  <tr align="center" valign="top">
  
  
  <td bgcolor="#EEEEFF" class="NavBarCell1">    <a href="overview-summary.html"><font class="NavBarFont1"><b>Overview</b></font></a>&nbsp;</td>
  <td bgcolor="#FFFFFF" class="NavBarCell1Rev">	&nbsp;<font class="NavBarFont1Rev"><b>File</b></font>&nbsp;</td>
  

  <td bgcolor="#FFFFFF" class="NavBarCell1"> <font class="NavBarFont1">Class</font>&nbsp;</td>
  <td bgcolor="#EEEEFF" class="NavBarCell1">    <a href="overview-tree.html"><font class="NavBarFont1"><b>Tree</b></font></a>&nbsp;</td>
  <td bgcolor="#EEEEFF" class="NavBarCell1">    <a href="index-all.html"--><font class="NavBarFont1"><b>Index</b></font></a>&nbsp;</td>
  <td bgcolor="#EEEEFF" class="NavBarCell1">    <a href="help-doc.html"><font class="NavBarFont1"><b>Help</b></font></a>&nbsp;</td>
  </tr>
</table>
</td>
<td bgcolor="#EEEEFF" align="right" valign="top"><em>
<b><a href='http://mapbuilder.sourceforge.net'>Community Map Builder</a> 22 Dec 2006</b></em>
</td>
</tr>

<tr>
<td bgcolor="white" class="NavBarCell2"><font size="-2">
&nbsp;PREV&nbsp;
&nbsp;NEXT</font></td>
<td bgcolor="white" class="NavBarCell2"><font size="-2">
  <a href="index.html" target="_top"><b>FRAMES</b></a>  &nbsp;
&nbsp;<a href="overview-summary.html" target="_top"><b>NO FRAMES</b></a>
&nbsp;&nbsp;
<script>
  <!--
  if(window==top) {
    document.writeln('<A HREF="allclasses-noframe.html" TARGET=""><B>All Classes</B></A>');
  }
  //-->
</script>
<noscript>
<a href="allclasses-noframe.html" target=""><b>All Classes</b></a>
</noscript>
</font></td>
</tr>
</table>
<!-- =========== END OF NAVBAR =========== -->

<hr>
<font size="-1">

</font>
<div class="jsdoc_ctime">Documentation generated by <a href="http://jsdoc.sourceforge.net/" target="_parent">JSDoc</a> on Fri Dec 22 07:58:58 2006</div>
</body>
</html>
